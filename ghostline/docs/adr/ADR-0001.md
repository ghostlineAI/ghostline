# ADR-0001: Initial Technology Stack Selection for GhostLine

- **Date**: 2025-06-26
- **Status**: Accepted

## Context

To build the GhostLine platform, we need to select a foundational set of open-source components and Large Language Models (LLMs). The goal is to choose a modern, maintainable, and cost-effective stack that aligns with our product vision. Key considerations include license compliance (avoiding viral licenses like AGPL), community support, project activity, and performance. An open-source capability scan was conducted (see `oss_scan.csv`) to inform these decisions.

## Decision

We have decided to adopt a primary stack based on Python for the backend/AI and Next.js/TypeScript for the frontend. The key components selected are:

### Core AI/ML and Agentic Framework

- **Agentic Framework**: **LangGraph**.
  - *Rationale*: Its graph-based structure is ideal for our complex, stateful, multi-agent workflows. It offers more explicit control over agent loops and state management compared to other frameworks like AutoGen or CrewAI, which is critical for the iterative nature of ghost-writing.
- **LLMs**:
  - **Primary Model**: **Claude 3 Haiku**. Chosen for its exceptional speed and low cost, making it suitable for drafting, summarization, and other high-volume tasks.
  - **Secondary Model**: **GPT-4o**. Reserved for quality-critical tasks like final editing, voice analysis, and complex reasoning, where its higher intelligence justifies the cost.
- **Data Ingestion**: **unstructured.io**.
  - *Rationale*: Excellent support for parsing a wide variety of document formats (PDF, DOCX, etc.) which is essential for handling author source materials.
- **Voice Similarity**: **sentence-transformers**.
  - *Rationale*: A proven library for generating high-quality sentence and text embeddings. This will be the foundation of our quantitative voice similarity metric (KPI: â‰¥ 0.88).

### Web & API Stack

- **Frontend Framework**: **Next.js** with **Tiptap** (for the rich text editor) and **Zustand** (for state management).
- **Backend Framework**: **FastAPI** with **Typer** (for CLIs).

### Developer Experience

- **Linting/Formatting**: **Ruff** and **pre-commit**.
  - *Rationale*: To ensure high code quality and consistency across all repositories from day one. Ruff's speed is a major developer productivity win.

## Consequences

- **Benefits**:
  - The selected stack is modern, popular, and well-supported (based on GitHub stars: LangGraph 14.8k, Zustand 53.1k, Tiptap 31.1k, Ruff 40.4k).
  - All components show recent activity (last commits within the past 15 days), indicating active maintenance.
  - We have a clear path for implementing our core features.
  - The choice of LLMs provides a good balance between cost and capability (Claude 3 Haiku: $0.00025/1k tokens at 800ms latency).
  - All selected components have permissive licenses (MIT, Apache 2.0), with fit scores of 70-100, satisfying our compliance requirements.
- **Risks & Mitigations**:
  - **Vendor Lock-in (LLM)**: By abstracting our agent interactions, we can design the system to be model-agnostic, allowing us to swap or add models like Mixtral in the future.
  - **LangGraph immaturity**: LangGraph is newer than some alternatives. We will mitigate this by contributing to the community and building our own abstractions where necessary.

## Rejected Options

- **`dramatiq`**: Rejected due to its `LGPL-3.0` license (fit score: 45). While not as restrictive as AGPL, we are opting for more permissive MIT/Apache licenses to avoid any potential future licensing complexities. We will use Celery as initially planned in the `api/README.md`.
- **AutoGen**: Rejected for multiple reasons: (1) Uses Creative Commons Attribution 4.0 International license rather than a standard software license, which creates uncertainty for commercial use; (2) More opinionated and less flexible than LangGraph for our iterative workflows.
- **CrewAI**: While MIT-licensed and popular (33,400 stars), it's more focused on autonomous agents rather than the controlled, iterative workflows we need for book generation.
- **Langfuse**: Shows "Other" license in GitHub API, creating licensing uncertainty. We'll monitor and evaluate alternatives for LLM observability if needed. 