# GhostLine Project Knowledge Base

## Last Updated: 2025-01-26

This document serves as a comprehensive knowledge transfer for LLMs working on the GhostLine project.
Each LLM should read this first and update it with new information.

## Project Overview

**GhostLine** is a production-grade, cloud-hosted ghost-writing platform that:

- Ingests an author's source materials (books, notes, PDFs, etc.)
- Uses an iterative multi-agent AI workflow to produce publishable books
- Targets â‰¥80-page books with â‰¥0.88 voice similarity to the author
- Domain: <https://ghostline.ai> (registered at GoDaddy, DNS will delegate to AWS Route 53)

## Current Status

### âœ… Phase 0: Bootstrap (COMPLETE)

- Created GitHub organization: `ghostlineAI`
- Set up 5 repositories: web, api, agents, infra, docs
- Established development standards (CODEOWNERS, PR templates, markdown linting)
- Created PROJECT_CHARTER.md with personas and KPIs
- Created ADR-0000.md documenting foundational decisions

### âœ… Phase 1: Open-Source Capability Scan (COMPLETE)

- Built `oss_capability_scan.py` to analyze GitHub repositories
- Generated `oss_scan.csv` with 18 libraries + 3 LLM benchmarks
- Created ADR-0001.md documenting technology stack
- Confirmed zero AGPL/viral licenses in selected stack

### âœ… Phase 2: High-Level Architecture Blueprint (COMPLETE)

- Created comprehensive architecture diagrams
- Documented data flow: upload â†’ ingestion â†’ chunk/embedding â†’ agent DAG
- Selected AWS ECS Fargate as compute platform
- Created ADR-0002.md with compute platform trade-offs

### âœ… Phase 3: AWS Landing Zone (COMPLETE)

- Created Terraform modules: organization, vpc, security, budget, kms
- Deployed bootstrap infrastructure:
  - S3 state bucket: `ghostline-terraform-state-820242943150`
  - DynamoDB table: `ghostline-terraform-locks`
  - KMS key for state encryption
- Deployed development environment:
  - VPC: `vpc-00d75267879c8f631` (10.0.0.0/16)
  - 6 subnets across 2 AZs (us-west-2a, us-west-2b)
  - S3 buckets: `ghostline-dev-source-materials-820242943150`, `ghostline-dev-outputs-820242943150`
  - Security groups for ALB, ECS, RDS
  - WAF Web ACL: `7529b94c-e8fe-4f43-9d35-cc3b87430d81`
  - GuardDuty, Security Hub, IAM Access Analyzer enabled
  - Budget alerts: $500/month total, service-specific limits
  - 6 KMS keys for different services
- Created deployment scripts: `setup-tools.sh`, `deploy.sh`
- Documented in: DEPLOYMENT_SUMMARY.md, PHASE_3_COMPLETE.md
- Estimated monthly cost: $30-45 for base infrastructure

### âœ… Phase 4: Repo & CI/CD Scaffolding (COMPLETE)

- Conducted competitor UI audit of 5 platforms
- Created ADR-0003.md choosing custom Tailwind + shadcn/ui
- Scaffolded Next.js 15.3.4 frontend with professional landing page
- Scaffolded FastAPI 0.115.14 backend with Poetry
- Scaffolded LangGraph agent system
- Created multi-stage Dockerfiles for all services
- Added GitHub Actions CI/CD pipelines
- Configured linting, testing, and ECR deployment

### ðŸ”œ Phase 5: Data Layer Foundation (NEXT)

- Deploy RDS PostgreSQL with pgvector extension
- Configure database security and backups
- Set up Redis for caching
- Create database migration framework
- Implement connection pooling

## Repository Structure

```
ghostline/
â”œâ”€â”€ web/          # Next.js frontend application
â”œâ”€â”€ api/          # FastAPI backend service
â”œâ”€â”€ agents/       # LangGraph multi-agent system
â”œâ”€â”€ infra/        # Terraform/AWS infrastructure
â”‚   â”œâ”€â”€ terraform/
â”‚   â”‚   â”œâ”€â”€ modules/        # Reusable Terraform modules
â”‚   â”‚   â”œâ”€â”€ environments/   # Environment-specific configs
â”‚   â”‚   â””â”€â”€ backend/        # State management config
â”‚   â”œâ”€â”€ deploy.sh          # Deployment script
â”‚   â””â”€â”€ setup-tools.sh     # Tool installation script
â””â”€â”€ docs/         # Documentation and ADRs
    â”œâ”€â”€ adr/      # Architecture Decision Records
    â”‚   â”œâ”€â”€ ADR-0000.md  # Foundational decisions
    â”‚   â”œâ”€â”€ ADR-0001.md  # Technology stack
    â”‚   â””â”€â”€ ADR-0002.md  # Compute platform (ECS Fargate)
    â”œâ”€â”€ scripts/  # Utility scripts (oss_capability_scan.py)
    â”œâ”€â”€ runbooks/ # Operational procedures
    â”‚   â””â”€â”€ oncall.md    # On-call runbook with PagerDuty
    â”œâ”€â”€ oss_scan.csv     # Technology evaluation results
    â”œâ”€â”€ PHASE_0_COMPLETE.md
    â”œâ”€â”€ PHASE_1_COMPLETE.md
    â”œâ”€â”€ PHASE_2_COMPLETE.md
    â”œâ”€â”€ PHASE_3_COMPLETE.md
    â”œâ”€â”€ FINAL_REVIEW_PHASES_0_3.md
    â””â”€â”€ KNOWLEDGE.md     # This file
```

## System Architecture (from Phase 2)

### High-Level Components

1.  **Client Layer**: Next.js frontend + Typer CLI
2.  **API Gateway**: AWS ALB with WAF protection
3.  **Application Layer**: FastAPI on ECS Fargate
4.  **Agent Orchestration**: LangGraph managing 8 specialized agents
5.  **Data Plane**: PostgreSQL + pgvector, Redis, S3
6.  **AI/ML Services**: AWS Bedrock (Claude) + OpenAI (GPT-4o)

### Data Flow

1.  **Upload**: Multipart to S3 with presigned URLs
2.  **Ingestion**: unstructured.io processing
3.  **Chunking**: 1000-token chunks with embeddings
4.  **Agent DAG**: Iterative chapter generation
5.  **Output**: Book compilation and export

### Compute Strategy (from ADR-0002)

- **Platform**: AWS ECS Fargate (serverless containers)
- **API Service**: 2-20 tasks (always on)
- **Workers**: 0-50 tasks (scale-to-zero)
- **Cost Optimization**: Fargate Spot for 70% savings
- **Scaling**: Queue-based via SQS depth

## Technology Stack (from ADR-0001)

### Core AI/ML

- **LangGraph** (14.8k stars, MIT) - Multi-agent orchestration
- **Claude 3 Haiku** - Primary LLM ($0.00025/1k tokens, 800ms latency)
- **GPT-4o** - Secondary LLM for quality-critical tasks
- **unstructured.io** - Document ingestion
- **sentence-transformers** - Voice similarity analysis

### Frontend

- **Next.js 14** - React framework
- **Zustand** (53.1k stars) - State management
- **Tiptap** (31.1k stars) - Rich text editor
- **TanStack Query** - Data fetching
- **Tailwind CSS + shadcn/ui** - Styling

### Backend

- **FastAPI 0.111** - Python web framework
- **PostgreSQL with pgvector** - Database
- **SQLAlchemy** - ORM
- **Celery with Redis** - Task queue
- **Typer** - CLI tool creation

### Infrastructure

- **AWS** - Cloud provider (Bedrock for LLMs)
- **Terraform** - Infrastructure as Code
- **Amazon ECS Fargate** - Container orchestration
- **GitHub Actions** - CI/CD

### Development

- **Ruff** - Python linting
- **ESLint** - JavaScript linting
- **pre-commit** - Git hooks

## Key Design Decisions

### From ADR-0000

1.  **AWS as cloud provider** - For AWS Bedrock access and scalability
2.  **Token-based billing** - Usage-based pricing model
3.  **Multi-agent architecture** - Specialized agents for different tasks

### From ADR-0001

1.  **LangGraph over AutoGen/CrewAI** - Better control for iterative workflows
2.  **Rejected dramatiq** - LGPL license concerns
3.  **Rejected AutoGen** - Creative Commons license uncertainty

### From ADR-0002

1.  **ECS Fargate over EC2** - Zero ops overhead worth 20% premium
2.  **Fargate over Lambda** - Need long-running tasks (>15 min)
3.  **Fargate over EKS** - Simpler operations, faster time to market
4.  **Fargate Spot for workers** - 70% cost reduction

## Important Context

### User Personas (from PROJECT_CHARTER.md)

1.  **Sarah Chen** - Business author wanting productivity book from blog posts
2.  **Marcus Rodriguez** - Memoirist with 40 years of journals
3.  **Elena Petrov** - Fiction writer wanting series consistency
4.  **David Kim** - Academic compiling research into textbook

### Core KPIs

- Book length: â‰¥80 pages
- Voice similarity: â‰¥0.88 cosine similarity
- Generation time: <7 days per book
- User satisfaction: >90% approval rate

### Agent System Design

- **OrchestratorAgent** - Workflow coordination
- **PlannerAgent** - Book structure creation
- **ResearchAgent** - Source material retrieval
- **ChapterAgent** - Chapter drafting
- **CriticAgent** - Quality review
- **VoiceAgent** - Voice/tone matching
- **ConsistencyAgent** - Plot/timeline validation
- **SafetyAgent** - Content policy compliance

## AWS Infrastructure Details (Phase 3)

### Account Information

- **AWS Account ID**: 820242943150
- **Primary Region**: us-west-2
- **Terraform State**: s3://ghostline-terraform-state-820242943150

### Deployed Resources

| Resource Type  | Resource ID/Name                                 | Purpose                     |
| :------------- | :----------------------------------------------- | :-------------------------- |
| VPC            | vpc-00d75267879c8f631                             | Main network (10.0.0.0/16)  |
| S3 Bucket      | ghostline-dev-source-materials-820242943150      | Source material storage     |
| S3 Bucket      | ghostline-dev-outputs-820242943150               | Generated book storage      |
| S3 Bucket      | ghostline-terraform-state-820242943150           | Terraform state             |
| DynamoDB Table | ghostline-terraform-locks                        | State locking               |
| WAF Web ACL    | 7529b94c-e8fe-4f43-9d35-cc3b87430d81             | Web application firewall    |
| KMS Keys       | 6 keys created                                   | Encryption for various services |

### Security Services Enabled

- **AWS WAF**: Protecting ALB endpoints
- **GuardDuty**: Threat detection active
- **Security Hub**: Compliance monitoring
- **CloudTrail**: Audit logging (without S3 logging due to KMS issues)
- **IAM Access Analyzer**: External access monitoring
- **Budget Alerts**: $500/month limit with service breakdowns

### Networking

- **Availability Zones**: us-west-2a, us-west-2b
- **Public Subnets**: 2 (for ALB)
- **Private Subnets**: 2 (for ECS/compute)
- **Database Subnets**: 2 (for RDS)
- **NAT Gateways**: 2 (one per AZ)
- **Internet Gateway**: 1

## GitHub Details

- Organization: `ghostlineAI` (<https://github.com/ghostlineAI>)
- All repositories are private
- Personal Access Token needed for API operations
- Markdown linting CI/CD configured
- CODEOWNERS set up for each repository

## Working Patterns

### File Organization

- Phase completion summaries go in root (e.g., PHASE_0_COMPLETE.md)
- Scripts for analysis go in `docs/scripts/`
- ADRs go in `docs/adr/` with format ADR-XXXX.md
- Each repository has its own README.md

### Development Flow

1.  Make changes locally in `ghostline/` directory
2.  Use `push_to_github.sh` script for bulk pushes
3.  Or push individual repos with standard git commands

### Testing Approach

- Unit tests for individual components
- Integration tests for agent workflows
- Voice similarity evaluation suite
- Token usage monitoring

## Common Commands

```bash
# Run OSS capability scan
export GITHUB_TOKEN='your_token'
python ghostline/scripts/oss_capability_scan.py

# Push all repos to GitHub
cd ghostline
bash push_to_github.sh

# Install Python dependencies
pip install pandas requests
poetry install  # for agent development

# AWS/Terraform commands
cd ghostline/infra
./setup-tools.sh              # Install AWS CLI and Terraform
./deploy.sh bootstrap         # Deploy state backend
./deploy.sh dev              # Deploy dev environment
terraform plan               # Preview changes
terraform apply             # Apply changes
```

## Next Phase (Phase 5) Requirements

According to the project plan:

- Deploy RDS PostgreSQL with pgvector extension
- Configure automated backups and point-in-time recovery
- Set up Redis cluster for caching
- Create Alembic migration framework
- Implement PgBouncer for connection pooling
- Configure read replicas for scaling

## Notes for Future LLMs

1.  **Always check `ghostline_phase_plan.txt`** for full project roadmap
2.  **Update this KNOWLEDGE.md** after completing significant work
3.  **Create ADRs** for architectural decisions
4.  **Maintain license compliance** - avoid AGPL/GPL libraries
5.  **Follow established patterns** - see existing code for examples
6.  **Test with real data** - use actual PDFs/documents when possible

## Recent Changes Log

### 2025-01-26 (Phases 0-3 COMPLETE)

- Initial project setup complete
- Technology stack selected and documented
- All repositories pushed to GitHub
- OSS capability scan completed
- Architecture blueprint created with Mermaid diagrams
- Compute platform decision documented (ECS Fargate)
- AWS Landing Zone fully deployed with Terraform:
  - VPC with 6 subnets across 2 AZs
  - S3 buckets for materials and outputs
  - Security services (WAF, GuardDuty, CloudTrail)
  - Budget monitoring ($500/month)
  - All infrastructure operational
- Created comprehensive final review document
- Email notifications pending manual SNS confirmation

---

*Remember to update this document as the project evolves!* 
